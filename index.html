<head>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/3d-force-graph"></script>
</head>

<body>
    <div id="idea-web"></div>
    <button id="btn-add" onclick="onAddItemClick()">Add Idea</button>
    <div id="modal-idea">
            Idea Name:<br>
            <input id="idea-name" type="text" name="name">
            <br>
            Tag:<br>
            <input id="idea-tag" type="text" name="tag">
            <br><br>
            <button type="submit" onclick="onModalSubmitClick()">Done</button>
    </div>
    <script>

        const web = document.getElementById('idea-web');
        const data = {
            nodes: [{id: 0, val: 10, name: "one", tags: ["c"]}, {id: 1, val: 1, name: "two", tags: ["ab", "rc"]}],
            links: [{source: 0, target: 1}]
        };

        const Graph = ForceGraph3D()
            (web)
                .graphData(data)
                .nodeLabel('name')
                .onNodeHover(node => web.style.cursor = node ? 'pointer': null);

        function onAddItemClick() {
            const modal = document.getElementById("modal-idea");
            modal.style.display = "block";    
        }

        function onModalSubmitClick() {
            const modal = document.getElementById("modal-idea");
            const ideaName = document.getElementById("idea-name");
            const ideaTag = document.getElementById("idea-tag");

            const { nodes, links } = Graph.graphData();
            const id = nodes.length;

            const newIdea = {
                id: id,
                name: ideaName.value,
                tags: [ideaTag.value] 
            };

            modal.style.display = "none";
            var newLinks = [];

            for(newTag of newIdea.tags) {
                for(idea of nodes) {
                    for (tag of idea.tags) {
                        if (tag == newTag) {
                            newLinks = [...newLinks, {source: newIdea.id, target: idea.id}]
                        }
                    }
                }   
            }
            Graph.graphData({
                    nodes: [...nodes, {...newIdea}],
                    links: [...links, ...newLinks]

                });
        } 

    </script>
</body>